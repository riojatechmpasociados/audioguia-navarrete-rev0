<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pago Completo - Audioguía</title>
</head>
<body>
    <h1>¡Gracias por tu compra!</h1>
    <p>Tu pago ha sido exitoso. Haz clic en el siguiente enlace para acceder a la audioguía. Este enlace estará disponible por 3 horas, pero solo se podrá usar en este dispositivo:</p>
    <a href="https://riojatechmpasociados.github.io/visita-navarrete/audioguia_navarrete.html?access_token=UNICO_CODIGO" id="access-link">Acceder a la Audioguía</a>

    <script>
        // Función para establecer una cookie
        function setCookie(name, value, hours) {
            const date = new Date();
            date.setTime(date.getTime() + (hours * 60 * 60 * 1000));  // Establecer la expiración en horas
            const expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        // Función para obtener una cookie
        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // Comprobar si el pago ya ha sido realizado
const paymentDone = getCookie('payment_done');
const paymentTime = getCookie('payment_time');

const expiryTime = 1 * 60 * 1000;  // 1 minuto en milisegundos (solo para pruebas)
const currentTime = new Date().getTime();

// Depuración: Verificar valores de tiempo
console.log('currentTime:', currentTime);
console.log('paymentTime:', paymentTime);

const accessLink = document.getElementById("access-link");

if (!paymentDone || !paymentTime) {
    // Si no hay registro de pago en este dispositivo, desactivar el enlace
    accessLink.href = "#";
    accessLink.innerText = "El enlace no está disponible.";
} else {
    // Comprobar si el tiempo de acceso ha expirado
    const timeLeft = currentTime - paymentTime;
    console.log('timeLeft:', timeLeft);
    
    if (timeLeft > expiryTime) {
        // Si el tiempo ha expirado, desactivar el enlace
        accessLink.href = "#";
        accessLink.innerText = "El enlace ha expirado.";
    } else {
        // Si el tiempo no ha expirado, mantener el enlace activo
        console.log('Acceso permitido');
    }
}

        // Si el pago acaba de realizarse, guardar los datos en la cookie
        if (!paymentDone && !paymentTime) {
            // Guardar el estado de pago y la hora del pago en cookies
            setCookie('payment_done', 'true', 3);  // La cookie durará 3 horas
            setCookie('payment_time', currentTime, 3);  // Guardar el momento del pago
        }
    </script>
</body>
</html>
